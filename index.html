<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE LIFF 應用程式 - Beefsteak</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
        }
        #profile {
            margin: 20px 0;
        }
        #messageInput {
            width: 200px;
            padding: 5px;
        }
        #qrCode {
            margin: 20px 0;
        }
        #qrInput {
            width: 200px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>LINE LIFF 功能示範</h1>
    <p>歡迎使用 Beefsteak LIFF 應用程式！</p>

    <button id="loginBtn">登入 LINE</button>
    <button id="profileBtn" disabled>取得個人資料</button>
    <button id="sendMsgBtn" disabled>傳送訊息</button>
    <button id="scanQrBtn" disabled>掃描 QR Code</button>
    <button id="shareBtn" disabled>分享目標選擇器</button>
    <button id="addFriendBtn" disabled>添加好友</button>
    <button id="generateQrBtn" disabled>生成 QR Code</button>

    <div id="profile"></div>

    <div>
        <input type="text" id="messageInput" placeholder="輸入訊息..." disabled>
        <button id="customSendBtn" disabled>自訂傳送</button>
    </div>

    <div>
        <input type="text" id="qrInput" placeholder="輸入 QR Code 內容..." value="https://liff.line.me/2008276630-bYNjwMx7">
        <button id="generateCustomQrBtn" disabled>生成自訂 QR Code</button>
    </div>
    <div id="qrCode"></div>

    <script>
        // LIFF ID 從設定中取得
        const LIFF_ID = '2008276630-bYNjwMx7';
        // LINE Official Account 的好友連結（假設為 @Beefsteak，請根據實際情況修改）
        const FRIEND_LINK = 'https://line.me/R/ti/p/@Beefsteak';

        async function initializeLiff() {
            try {
                await liff.init({
                    liffId: LIFF_ID
                });
                console.log('LIFF 初始化成功');
                updateUI();
            } catch (error) {
                console.error('LIFF 初始化失敗', error);
                alert('LIFF 初始化失敗: ' + error.message);
            }
        }

        function updateUI() {
            const loginBtn = document.getElementById('loginBtn');
            const profileBtn = document.getElementById('profileBtn');
            const sendMsgBtn = document.getElementById('sendMsgBtn');
            const scanQrBtn = document.getElementById('scanQrBtn');
            const shareBtn = document.getElementById('shareBtn');
            const addFriendBtn = document.getElementById('addFriendBtn');
            const generateQrBtn = document.getElementById('generateQrBtn');
            const messageInput = document.getElementById('messageInput');
            const customSendBtn = document.getElementById('customSendBtn');
            const qrInput = document.getElementById('qrInput');
            const generateCustomQrBtn = document.getElementById('generateCustomQrBtn');

            if (liff.isLoggedIn()) {
                loginBtn.style.display = 'none';
                profileBtn.disabled = false;
                addFriendBtn.disabled = false;
                generateQrBtn.disabled = false;
                qrInput.disabled = false;
                generateCustomQrBtn.disabled = false;
                if (liff.isInClient()) {
                    sendMsgBtn.disabled = false;
                    scanQrBtn.disabled = false;
                    shareBtn.disabled = false;
                    messageInput.disabled = false;
                    customSendBtn.disabled = false;
                } else {
                    alert('傳送訊息和掃描 QR Code 等功能僅在 LINE 應用程式內可用。');
                }
            } else {
                loginBtn.style.display = 'inline-block';
                profileBtn.disabled = true;
                sendMsgBtn.disabled = true;
                scanQrBtn.disabled = true;
                shareBtn.disabled = true;
                addFriendBtn.disabled = true;
                generateQrBtn.disabled = true;
                messageInput.disabled = true;
                customSendBtn.disabled = true;
                qrInput.disabled = true;
                generateCustomQrBtn.disabled = true;
            }
        }

        document.getElementById('loginBtn').addEventListener('click', () => {
            liff.login();
        });

        document.getElementById('profileBtn').addEventListener('click', async () => {
            try {
                const profile = await liff.getProfile();
                document.getElementById('profile').innerHTML = `
                    <h2>個人資料</h2>
                    <p>使用者 ID: ${profile.userId}</p>
                    <p>顯示名稱: ${profile.displayName}</p>
                    <img src="${profile.pictureUrl}" alt="頭像" style="width: 100px; height: 100px; border-radius: 50%;">
                    <p>狀態訊息: ${profile.statusMessage || '無'}</p>
                `;
            } catch (error) {
                console.error('取得個人資料失敗', error);
                alert('取得個人資料失敗');
            }
        });

        document.getElementById('sendMsgBtn').addEventListener('click', async () => {
            if (!liff.isInClient()) {
                alert('此功能僅在 LINE 應用程式內可用。');
                return;
            }
            try {
                await liff.sendMessages([{
                    type: 'text',
                    text: 'Hello, World! 這是來自 LIFF 應用程式的訊息。'
                }]);
                alert('訊息傳送成功！');
            } catch (error) {
                console.error('傳送訊息失敗', error);
                alert('傳送訊息失敗: ' + error.message);
            }
        });

        document.getElementById('customSendBtn').addEventListener('click', async () => {
            if (!liff.isInClient()) {
                alert('此功能僅在 LINE 應用程式內可用。');
                return;
            }
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();
            if (!text) {
                alert('請輸入訊息內容。');
                return;
            }
            try {
                await liff.sendMessages([{
                    type: 'text',
                    text: text
                }]);
                alert('自訂訊息傳送成功！');
                messageInput.value = '';
            } catch (error) {
                console.error('傳送訊息失敗', error);
                alert('傳送訊息失敗: ' + error.message);
            }
        });

        document.getElementById('scanQrBtn').addEventListener('click', async () => {
            try {
                const result = await liff.scanCode();
                alert('掃描結果: ' + result.value);
            } catch (error) {
                console.error('掃描 QR Code 失敗', error);
                alert('掃描 QR Code 失敗');
            }
        });

        document.getElementById('shareBtn').addEventListener('click', async () => {
            try {
                await liff.shareTargetPicker([
                    {
                        type: 'text',
                        text: 'Hello, World! 這是分享的訊息。'
                    }
                ]);
                alert('分享成功！');
            } catch (error) {
                console.error('分享失敗', error);
                alert('分享失敗: ' + error.message);
            }
        });

        document.getElementById('addFriendBtn').addEventListener('click', async () => {
            try {
                if (liff.isInClient()) {
                    await liff.openWindow({
                        url: FRIEND_LINK,
                        external: true
                    });
                    alert('正在開啟好友添加頁面...');
                } else {
                    window.open(FRIEND_LINK, '_blank');
                    alert('請在瀏覽器中添加好友。');
                }
            } catch (error) {
                console.error('添加好友失敗', error);
                alert('添加好友失敗: ' + error.message);
            }
        });

        document.getElementById('generateQrBtn').addEventListener('click', () => {
            const qrCodeDiv = document.getElementById('qrCode');
            qrCodeDiv.innerHTML = ''; // 清空舊的 QR Code
            QRCode.toCanvas('https://liff.line.me/2008276630-bYNjwMx7', { errorCorrectionLevel: 'H' }, (err, canvas) => {
                if (err) {
                    console.error('生成 QR Code 失敗', err);
                    alert('生成 QR Code 失敗');
                    return;
                }
                qrCodeDiv.appendChild(canvas);
                alert('已生成 LIFF URL 的 QR Code！');
            });
        });

        document.getElementById('generateCustomQrBtn').addEventListener('click', () => {
            const qrInput = document.getElementById('qrInput').value.trim();
            if (!qrInput) {
                alert('請輸入 QR Code 內容！');
                return;
            }
            const qrCodeDiv = document.getElementById('qrCode');
            qrCodeDiv.innerHTML = ''; // 清空舊的 QR Code
            QRCode.toCanvas(qrInput, { errorCorrectionLevel: 'H' }, (err, canvas) => {
                if (err) {
                    console.error('生成自訂 QR Code 失敗', err);
                    alert('生成自訂 QR Code 失敗');
                    return;
                }
                qrCodeDiv.appendChild(canvas);
                alert('已生成自訂 QR Code！');
            });
        });

        // 頁面載入完成後初始化 LIFF
        window.onload = () => {
            initializeLiff();
        };

        // LIFF 狀態變更時更新 UI
        liff.on('update:liffState', () => {
            updateUI();
        });
    </script>
</body>
</html>
