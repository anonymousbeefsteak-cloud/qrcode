<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L2O</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="font-family: Arial; text-align: center; padding: 20px; background: #fff;">
    <h1>🔄 載入中...</h1>
    <div id="status">初始化...</div>
    <div id="debug"></div>

    <script>
        const LIFF_ID = '2008276630-bYNjwMx7';
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxfrYlDMYiERpd1FRGNvp8QACLfm1jbm0yKVUq3RKD-YQfPcWLvEXDH6eBtPIRbOiKPig/exec';

        function log(msg) {
            document.getElementById('debug').innerHTML += `<p>${msg}</p>`;
            console.log(msg);
        }

        async function init() {
            log('1. 開始 LIFF 初始化');
            document.getElementById('status').innerHTML = '1. 初始化 LIFF...';
            
            try {
                await liff.init({ liffId: LIFF_ID });
                log('✅ LIFF 初始化成功');
                document.getElementById('status').innerHTML = '✅ LIFF OK';
                
                if (!liff.isLoggedIn()) {
                    log('2. 需要登入');
                    document.getElementById('status').innerHTML = '2. 登入中...';
                    liff.login();
                    return;
                }
                
                log('3. 已登入');
                document.getElementById('status').innerHTML = '3. 取得資料...';
                
                const profile = await liff.getProfile();
                log(`👤 用戶: ${profile.displayName} (${profile.userId})`);
                
                document.getElementById('status').innerHTML = `👋 ${profile.displayName}`;
                
                // 傳送到後端
                log('4. 傳送資料...');
                const res = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(profile)
                });
                const result = await res.json();
                log(`✅ 後端: ${result.message}`);
                
                document.getElementById('status').innerHTML = '🎉 加入成功！';
                
            } catch (error) {
                log(`❌ 錯誤: ${error}`);
                document.getElementById('status').innerHTML = `❌ ${error.message}`;
            }
        }

        // 立即執行
        window.onload = init;
    </script>
</body>
</html>
