<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L2O LIFF App</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #status { margin-top: 20px; font-weight: bold; }
        button { padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>歡迎加入無名牛排</h1>
    <p>點擊按鈕提交您的 LINE 資訊到 Google Sheets。</p>
    <button id="submitBtn">提交資訊</button>
    <div id="status"></div>

    <script>
        async function main() {
            try {
                await liff.init({ liffId: '2008276630-bYNjwMx7' });
                if (!liff.isLoggedIn()) {
                    liff.login({ redirectUri: window.location.href });
                } else {
                    document.getElementById('submitBtn').disabled = false;
                }
            } catch (error) {
                document.getElementById('status').textContent = 'LIFF 初始化失敗: ' + error.message;
                document.getElementById('status').style.color = 'red';
            }
        }

        document.getElementById('submitBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('status');
            statusEl.textContent = '正在取得資料...';
            statusEl.style.color = 'blue';

            try {
                const profile = await liff.getProfile();
                const data = {
                    userId: profile.userId,
                    displayName: profile.displayName,
                    pictureUrl: profile.pictureUrl,
                    statusMessage: profile.statusMessage || ''
                };

                const response = await fetch('https://script.google.com/macros/s/AKfycby0rb6FgDMz6XihnKDe847Kg22BxGeZ4WNJctf9mAJGl_6nbdZJgrI0V0Wv1uAmOyZIow/exec', {
                    method: 'POST',
                    mode: 'no-cors',  // 避免 CORS 問題，GAS 支援匿名存取
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                // 注意: no-cors 模式下無法讀取回應，但假設成功
                statusEl.textContent = '提交成功！您的資訊已記錄。';
                statusEl.style.color = 'green';
            } catch (error) {
                statusEl.textContent = '提交失敗: ' + error.message;
                statusEl.style.color = 'red';
            }
        });

        main();
    </script>
</body>
</html>
