<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>無名牛排 - 會員綁定</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  body { font-family: Arial, "Microsoft JhengHei", sans-serif; background:#faf7f2; color:#333; }
  .card { max-width:480px; margin:60px auto; background:#fff; padding:24px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.08); text-align:center }
  img.avatar { width:96px; height:96px; border-radius:50%; object-fit:cover; margin-bottom:12px; }
  button { background:#8B4513; color:#fff; border:none; padding:10px 18px; border-radius:6px; cursor:pointer }
</style>
</head>
<body>
  <div class="card">
    <h1>🥩 無名牛排 會員綁定</h1>
    <p id="status">正在初始化 LIFF…</p>
    <img id="avatar" class="avatar" src="" alt="" style="display:none">
    <h2 id="name" style="margin:10px 0"></h2>
    <p id="result"></p>
    <div style="margin-top:12px"><button id="closeBtn" style="display:none" onclick="liff.closeWindow()">關閉</button></div>
  </div>

<script>
const LIFF_ID = "2008289130-9XPR8Kpj";
const GAS_URL = "https://script.google.com/macros/s/AKfycbzqz4S0thSUZ9zY1PO8K_BMTvZde-MJfCSVsNEWR3NtnT-x55CZj38VtqWcl4GOuv62pQ/exec";

async function initLiff() {
  try {
    await liff.init({ liffId: LIFF_ID });
    document.getElementById('status').textContent = 'LIFF 已初始化';
    if (!liff.isLoggedIn()) { liff.login(); return; }

    const profile = await liff.getProfile();
    document.getElementById('name').textContent = profile.displayName;
    document.getElementById('avatar').src = profile.pictureUrl || '';
    if (profile.pictureUrl) document.getElementById('avatar').style.display = 'block';
    document.getElementById('status').textContent = '正在將資料傳送至後端…';

    const payload = {
      userId: profile.userId,
      displayName: profile.displayName,
      pictureUrl: profile.pictureUrl || '',
      statusMessage: ''
    };

    const res = await fetch(GAS_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const json = await res.json();
    if (json.success) {
      document.getElementById('result').textContent = '✅ ' + json.message;
    } else {
      document.getElementById('result').textContent = '⚠️ ' + json.message;
    }
    document.getElementById('closeBtn').style.display = 'inline-block';

  } catch (err) {
    console.error(err);
    document.getElementById('status').textContent = '初始化失敗: ' + err.message;
  }
}

window.addEventListener('load', initLiff);
</script>
</body>
</html>
