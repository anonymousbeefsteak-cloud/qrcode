<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç„¡åç‰›æ’ - åŠ å…¥å¥½å‹</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="margin:0;padding:20px;background:#f0f0f0;display:flex;justify-content:center;align-items:center;min-height:100vh;">
    <div style="background:white;padding:30px;border-radius:15px;text-align:center;max-width:400px;">
        <div style="font-size:48px;">ğŸ¥©</div>
        <h2>ç„¡åç‰›æ’</h2>
        <p>é»æ“ŠæŒ‰éˆ•åŠ å…¥å®˜æ–¹å¸³è™Ÿ</p>
        
        <img src="https://qr-official.line.me/sid/L/561zotgq.png" 
             style="max-width:200px;margin:15px 0;border:2px solid #ddd;border-radius:10px;">
        <p><strong>LINE ID: @561zotgq</strong></p>
        
        <button onclick="joinLine()" 
                style="background:#00B900;color:white;border:none;padding:15px 30px;font-size:18px;border-radius:10px;cursor:pointer;width:100%;margin:20px 0;">
            åŠ å…¥å¥½å‹
        </button>
        
        <div id="status" style="margin:15px 0;padding:10px;border-radius:5px;display:none;"></div>
    </div>

    <script>
        async function initialize() {
            try {
                await liff.init({liffId: '2008276630-bYNjwMx7'});
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }
                // éœé»˜è¨˜éŒ„ - ä¸é¡¯ç¤ºç‹€æ…‹
                const profile = await liff.getProfile();
                silentRecordUser(profile);
            } catch (error) {
                console.log('åˆå§‹åŒ–å®Œæˆ');
            }
        }

        function silentRecordUser(profile) {
            // ä½¿ç”¨ Image ç‰©ä»¶ç™¼é€è«‹æ±‚ (ä¸æœƒè¢« CORS é˜»æ“‹)
            const url = `https://script.google.com/macros/s/AKfycbzaLgTqrmFqyINkHTQIwa049kLzkIQXRdq3nEji-HjWITO1lbSQ0z0P_Qfr4GNzgi0m3w/exec?userId=${encodeURIComponent(profile.userId)}&displayName=${encodeURIComponent(profile.displayName)}&timestamp=${encodeURIComponent(new Date().toISOString())}`;
            const img = new Image();
            img.src = url;
        }

        function joinLine() {
            if (liff.isInClient()) {
                liff.openWindow({url: 'line://ti/p/@561zotgq'});
            } else {
                window.open('https://line.me/R/ti/p/@561zotgq', '_blank');
            }
        }

        window.onload = initialize;
    </script>
</body>
</html>
