<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L2O</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="font-family: Arial; text-align: center; padding: 20px; background: #fff;">
    <h1>ğŸ”„ è¼‰å…¥ä¸­...</h1>
    <div id="status">åˆå§‹åŒ–...</div>
    <div id="debug"></div>

    <script>
        const LIFF_ID = '2008276630-bYNjwMx7';
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxfrYlDMYiERpd1FRGNvp8QACLfm1jbm0yKVUq3RKD-YQfPcWLvEXDH6eBtPIRbOiKPig/exec';

        function log(msg) {
            document.getElementById('debug').innerHTML += `<p>${msg}</p>`;
            console.log(msg);
        }

        async function init() {
            log('1. é–‹å§‹ LIFF åˆå§‹åŒ–');
            document.getElementById('status').innerHTML = '1. åˆå§‹åŒ– LIFF...';
            
            try {
                await liff.init({ liffId: LIFF_ID });
                log('âœ… LIFF åˆå§‹åŒ–æˆåŠŸ');
                document.getElementById('status').innerHTML = 'âœ… LIFF OK';
                
                if (!liff.isLoggedIn()) {
                    log('2. éœ€è¦ç™»å…¥');
                    document.getElementById('status').innerHTML = '2. ç™»å…¥ä¸­...';
                    liff.login();
                    return;
                }
                
                log('3. å·²ç™»å…¥');
                document.getElementById('status').innerHTML = '3. å–å¾—è³‡æ–™...';
                
                const profile = await liff.getProfile();
                log(`ğŸ‘¤ ç”¨æˆ¶: ${profile.displayName} (${profile.userId})`);
                
                document.getElementById('status').innerHTML = `ğŸ‘‹ ${profile.displayName}`;
                
                // å‚³é€åˆ°å¾Œç«¯
                log('4. å‚³é€è³‡æ–™...');
                const res = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(profile)
                });
                const result = await res.json();
                log(`âœ… å¾Œç«¯: ${result.message}`);
                
                document.getElementById('status').innerHTML = 'ğŸ‰ åŠ å…¥æˆåŠŸï¼';
                
            } catch (error) {
                log(`âŒ éŒ¯èª¤: ${error}`);
                document.getElementById('status').innerHTML = `âŒ ${error.message}`;
            }
        }

        // ç«‹å³åŸ·è¡Œ
        window.onload = init;
    </script>
</body>
</html>
